<!DOCTYPE html>
<html>
<head>
    <title>MutPy mutation report - mutation #10</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css">
    
<link href="http://alexgorbatchev.com/pub/sh/current/styles/shCore.css" rel="stylesheet" type="text/css" />
<link href="http://alexgorbatchev.com/pub/sh/current/styles/shThemeDefault.css" rel="stylesheet" type="text/css" />

    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    
<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shCore.js" type="text/javascript"></script>
<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushPython.js" type="text/javascript"></script>
<script type="text/javascript">
    SyntaxHighlighter.all();
    window.setTimeout(function () {
        
        $('.line.number57').attr('title', 'COI');
        
    }, 0);
</script>

</head>
<body>
    <div class="container">
        
<div class="page-header">
    <h1>Mutation #10</h1>
</div>
<h3>Details</h3>
<ul>
    <li>module - <code><module 'cookiecutter.config' from '/usr/baki/python_projects/cookiecutter/cookiecutter/config.py'></code></li>
    <li><span class="label label-success">killed</span> by <code>tests/test_get_config.py::test_get_config</code></li>
    
    <li>duration - 0.812 s</li>
    
    
    <li>tests run - -133</li>
    
</ul>

<h3>Exception traceback</h3>
<pre>def test_get_config():
        """Verify valid config opened and rendered correctly."""
>       conf = config.get_config('tests/test-config/valid-config.yaml')

tests/test_get_config.py:54: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

config_path = 'tests/test-config/valid-config.yaml'

>   ???
E   cookiecutter.exceptions.ConfigDoesNotExistException: Config file tests/test-config/valid-config.yaml does not exist.

cookiecutter.config:58: ConfigDoesNotExistException</pre>

<h3>Mutations</h3>
<ul>
    
    <li>COI - line 57</li>
    
</ul>
<h3>Mutant</h3>
<pre class="brush: python; first-line: 1; highlight: [57]; toolbar: false;">'''Global configuration handling.'''
import collections
import copy
import logging
import os

import poyo

from cookiecutter.exceptions import ConfigDoesNotExistException, InvalidConfiguration

logger = logging.getLogger(__name__)

USER_CONFIG_PATH = os.path.expanduser('~/.cookiecutterrc')

BUILTIN_ABBREVIATIONS = {\
    'gh': 'https://github.com/{0}.git', \
    'gl': 'https://gitlab.com/{0}.git', \
    'bb': 'https://bitbucket.org/{0}'}


DEFAULT_CONFIG = {\
    'cookiecutters_dir': os.path.expanduser('~/.cookiecutters/'), \
    'replay_dir': os.path.expanduser('~/.cookiecutter_replay/'), \
    'default_context': collections.OrderedDict([]), \
    'abbreviations': BUILTIN_ABBREVIATIONS}



def _expand_path(path):
    '''Expand both environment variables and user home in the given path.'''
    path = os.path.expandvars(path)
    path = os.path.expanduser(path)
    return path


def merge_configs(default, overwrite):
    '''Recursively update a dict with the key/value pair of another.

    Dict values that are dictionaries themselves will be updated, whilst
    preserving existing keys.
    '''
    new_config = copy.deepcopy(default)
    
    for (k, v) in overwrite.items():
        
        
        if isinstance(v, dict):
            new_config[k] = merge_configs(default[k], v)
        else:
            new_config[k] = v
    
    return new_config


def get_config(config_path):
    '''Retrieve the config from the specified path, returning a config dict.'''
    if not ((not (os.path.exists(config_path)))):
        raise ConfigDoesNotExistException(
            'Config file {} does not exist.'.format(config_path))
    
    
    logger.debug('config_path is %s', config_path)
    with open(config_path, encoding='utf-8') as file_handle:
        try:
            yaml_dict = poyo.parse_string(file_handle.read())
        except poyo.exceptions.PoyoException as e:
            raise InvalidConfiguration(
                'Unable to parse YAML file {}. Error: {}'.format(config_path, e))
    
    
    config_dict = merge_configs(DEFAULT_CONFIG, yaml_dict)
    
    raw_replay_dir = config_dict['replay_dir']
    config_dict['replay_dir'] = _expand_path(raw_replay_dir)
    
    raw_cookies_dir = config_dict['cookiecutters_dir']
    config_dict['cookiecutters_dir'] = _expand_path(raw_cookies_dir)
    
    return config_dict


def get_user_config(config_file=None, default_config=False):
    '''Return the user config as a dict.

    If ``default_config`` is True, ignore ``config_file`` and return default
    values for the config parameters.

    If a path to a ``config_file`` is given, that is different from the default
    location, load the user config from that.

    Otherwise look up the config file path in the ``COOKIECUTTER_CONFIG``
    environment variable. If set, load the config from this path. This will
    raise an error if the specified path is not valid.

    If the environment variable is not set, try the default config file path
    before falling back to the default config values.
    '''
    
    if default_config:
        logger.debug('Force ignoring user config with default_config switch.')
        return copy.copy(DEFAULT_CONFIG)
    
    
    if (config_file and config_file is not USER_CONFIG_PATH):
        logger.debug('Loading custom config from %s.', config_file)
        return get_config(config_file)
    
    try:
        
        env_config_file = os.environ['COOKIECUTTER_CONFIG']
    except KeyError:
        
        
        if os.path.exists(USER_CONFIG_PATH):
            logger.debug('Loading config from %s.', USER_CONFIG_PATH)
            return get_config(USER_CONFIG_PATH)
        else:
            logger.debug('User config not found. Loading default config.')
            return copy.copy(DEFAULT_CONFIG)
    else:
        
        
        logger.debug('User config not found or not specified. Loading default config.')
        return get_config(env_config_file)</pre>

    </div>
</body>
</html>