<!DOCTYPE html>
<html>
<head>
    <title>MutPy mutation report - mutation #41</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css">
    
<link href="http://alexgorbatchev.com/pub/sh/current/styles/shCore.css" rel="stylesheet" type="text/css" />
<link href="http://alexgorbatchev.com/pub/sh/current/styles/shThemeDefault.css" rel="stylesheet" type="text/css" />

    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    
<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shCore.js" type="text/javascript"></script>
<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushPython.js" type="text/javascript"></script>
<script type="text/javascript">
    SyntaxHighlighter.all();
    window.setTimeout(function () {
        
        $('.line.number78').attr('title', 'COI');
        
    }, 0);
</script>

</head>
<body>
    <div class="container">
        
<div class="page-header">
    <h1>Mutation #41</h1>
</div>
<h3>Details</h3>
<ul>
    <li>module - <code><module 'cookiecutter.main' from '/usr/baki/python_projects/cookiecutter/cookiecutter/main.py'></code></li>
    <li><span class="label label-success">killed</span> by <code>tests/test_main.py::test_replay_dump_template_name</code></li>
    
    <li>duration - 0.736 s</li>
    
    
</ul>

<h3>Exception traceback</h3>
<pre>monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x7fc91f38b0d0>
mocker = <pytest_mock.plugin.MockFixture object at 0x7fc91f38b130>
user_config_data = {'cookiecutters_dir': '/tmp/pytest-of-ubuntu/pytest-389/user_dir0/cookiecutters', 'replay_dir': '/tmp/pytest-of-ubuntu/pytest-389/user_dir0/cookiecutter_replay'}
user_config_file = '/tmp/pytest-of-ubuntu/pytest-389/user_dir0/config'

    def test_replay_dump_template_name(
        monkeypatch, mocker, user_config_data, user_config_file
    ):
        """Check that replay_dump is called with a valid template_name.
    
        Template name must not be a relative path.
    
        Otherwise files such as ``..json`` are created, which are not just cryptic
        but also later mistaken for replay files of other templates if invoked with
        '.' and '--replay'.
    
        Change the current working directory temporarily to 'tests/fake-repo-tmpl'
        for this test and call cookiecutter with '.' for the target template.
        """
        monkeypatch.chdir('tests/fake-repo-tmpl')
    
        mock_replay_dump = mocker.patch('cookiecutter.main.dump')
        mocker.patch('cookiecutter.main.generate_files')
    
>       cookiecutter(
            '.', no_input=True, replay=False, config_file=user_config_file,
        )

/usr/baki/python_projects/cookiecutter/tests/test_main.py:24: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cookiecutter.main:80: in cookiecutter
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

replay_dir = '/tmp/pytest-of-ubuntu/pytest-389/user_dir0/cookiecutter_replay', template_name = 'fake-repo-tmpl'

    def load(replay_dir, template_name):
        """Read json data from file."""
        if not isinstance(template_name, str):
            raise TypeError('Template name is required to be of type str')
    
        replay_file = get_file_name(replay_dir, template_name)
    
>       with open(replay_file, 'r') as infile:
E       FileNotFoundError: [Errno 2] No such file or directory: '/tmp/pytest-of-ubuntu/pytest-389/user_dir0/cookiecutter_replay/fake-repo-tmpl.json'

/usr/baki/python_projects/cookiecutter/cookiecutter/replay.py:46: FileNotFoundError</pre>

<h3>Mutations</h3>
<ul>
    
    <li>COI - line 78</li>
    
</ul>
<h3>Mutant</h3>
<pre class="brush: python; first-line: 1; highlight: [78]; toolbar: false;">'''
Main entry point for the `cookiecutter` command.

The code in this module is also a good example of how to use Cookiecutter as a
library rather than a script.
'''
import logging
import os

from cookiecutter.config import get_user_config
from cookiecutter.exceptions import InvalidModeException
from cookiecutter.generate import generate_context, generate_files
from cookiecutter.prompt import prompt_for_config
from cookiecutter.replay import dump, load
from cookiecutter.repository import determine_repo_dir
from cookiecutter.utils import rmtree

logger = logging.getLogger(__name__)


def cookiecutter(\
    template, \
    checkout=None, \
    no_input=False, \
    extra_context=None, \
    replay=None, \
    overwrite_if_exists=False, \
    output_dir='.', \
    config_file=None, \
    default_config=False, \
    password=None, \
    directory=None, \
    skip_if_file_exists=False, \
    accept_hooks=True):
    
    '''
    Run Cookiecutter just as if using it from the command line.

    :param template: A directory containing a project template directory,
        or a URL to a git repository.
    :param checkout: The branch, tag or commit ID to checkout after clone.
    :param no_input: Prompt the user at command line for manual configuration?
    :param extra_context: A dictionary of context that overrides default
        and user configuration.
    :param replay: Do not prompt for input, instead read from saved json. If
        ``True`` read from the ``replay_dir``.
        if it exists
    :param output_dir: Where to output the generated project dir into.
    :param config_file: User configuration file path.
    :param default_config: Use default values rather than a config file.
    :param password: The password to use when extracting the repository.
    :param directory: Relative path to a cookiecutter template in a repository.
    :param accept_hooks: Accept pre and post hooks if set to `True`.
    '''
    if (replay and (no_input is not False or extra_context is not None)):
        err_msg = \
            'You can not use both replay and no_input or extra_context at the same time.'
        
        
        raise InvalidModeException(err_msg)
    
    config_dict = get_user_config(config_file=\
        config_file, default_config=default_config)
    
    
    (repo_dir, cleanup) = determine_repo_dir(template=\
        template, abbreviations=\
        config_dict['abbreviations'], clone_to_dir=\
        config_dict['cookiecutters_dir'], checkout=\
        checkout, no_input=\
        no_input, password=\
        password, directory=\
        directory)
    
    
    template_name = os.path.basename(os.path.abspath(repo_dir))
    
    if not replay:
        if isinstance(replay, bool):
            context = load(config_dict['replay_dir'], template_name)
        else:
            (path, template_name) = os.path.split(os.path.splitext(replay)[0])
            context = load(path, template_name)
    else:
        context_file = os.path.join(repo_dir, 'cookiecutter.json')
        logger.debug('context_file is %s', context_file)
        
        context = generate_context(context_file=\
            context_file, default_context=\
            config_dict['default_context'], extra_context=\
            extra_context)
        
        
        
        
        context['cookiecutter'] = prompt_for_config(context, no_input)
        
        
        context['cookiecutter']['_template'] = template
        
        
        context['cookiecutter']['_output_dir'] = os.path.abspath(output_dir)
        
        dump(config_dict['replay_dir'], template_name, context)
    
    
    result = generate_files(repo_dir=\
        repo_dir, context=\
        context, overwrite_if_exists=\
        overwrite_if_exists, skip_if_file_exists=\
        skip_if_file_exists, output_dir=\
        output_dir, accept_hooks=\
        accept_hooks)
    
    
    
    if cleanup:
        rmtree(repo_dir)
    
    return result</pre>

    </div>
</body>
</html>