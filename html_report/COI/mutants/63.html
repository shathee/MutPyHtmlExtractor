<!DOCTYPE html>
<html>
<head>
    <title>MutPy mutation report - mutation #63</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css">
    
<link href="http://alexgorbatchev.com/pub/sh/current/styles/shCore.css" rel="stylesheet" type="text/css" />
<link href="http://alexgorbatchev.com/pub/sh/current/styles/shThemeDefault.css" rel="stylesheet" type="text/css" />

    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    
<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shCore.js" type="text/javascript"></script>
<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushPython.js" type="text/javascript"></script>
<script type="text/javascript">
    SyntaxHighlighter.all();
    window.setTimeout(function () {
        
        $('.line.number84').attr('title', 'COI');
        
    }, 0);
</script>

</head>
<body>
    <div class="container">
        
<div class="page-header">
    <h1>Mutation #63</h1>
</div>
<h3>Details</h3>
<ul>
    <li>module - <code><module 'cookiecutter.utils' from '/usr/baki/python_projects/cookiecutter/cookiecutter/utils.py'></code></li>
    <li><span class="label label-success">killed</span> by <code>tests/test_utils.py::test_prompt_should_ask_and_rm_repo_dir</code></li>
    
    <li>duration - 0.734 s</li>
    
    
    <li>tests run - -125</li>
    
</ul>

<h3>Exception traceback</h3>
<pre>mocker = <pytest_mock.plugin.MockFixture object at 0x7fc91e77b880>
tmp_path = PosixPath('/tmp/pytest-of-ubuntu/pytest-396/test_prompt_should_ask_and_rm_0')

    def test_prompt_should_ask_and_rm_repo_dir(mocker, tmp_path):
        """In `prompt_and_delete()`, if the user agrees to delete/reclone the \
        repo, the repo should be deleted."""
        mock_read_user = mocker.patch(
            'cookiecutter.utils.read_user_yes_no', return_value=True
        )
        repo_dir = Path(tmp_path, 'repo')
        repo_dir.mkdir()
    
        deleted = utils.prompt_and_delete(str(repo_dir))
    
>       assert mock_read_user.called
E       AssertionError

tests/test_utils.py:101: AssertionError</pre>

<h3>Mutations</h3>
<ul>
    
    <li>COI - line 84</li>
    
</ul>
<h3>Mutant</h3>
<pre class="brush: python; first-line: 1; highlight: [84]; toolbar: false;">'''Helper functions used throughout Cookiecutter.'''
import contextlib
import errno
import logging
import os
import shutil
import stat
import sys

from cookiecutter.prompt import read_user_yes_no

logger = logging.getLogger(__name__)


def force_delete(func, path, exc_info):
    '''Error handler for `shutil.rmtree()` equivalent to `rm -rf`.

    Usage: `shutil.rmtree(path, onerror=force_delete)`
    From stackoverflow.com/questions/1889597
    '''
    os.chmod(path, stat.S_IWRITE)
    func(path)


def rmtree(path):
    '''Remove a directory and all its contents. Like rm -rf on Unix.

    :param path: A directory path.
    '''
    shutil.rmtree(path, onerror=force_delete)


def make_sure_path_exists(path):
    '''Ensure that a directory exists.

    :param path: A directory path.
    '''
    logger.debug('Making sure path exists: %s', path)
    try:
        os.makedirs(path)
        logger.debug('Created directory at: %s', path)
    except OSError as exception:
        if exception.errno != errno.EEXIST:
            return False
    return True



@contextlib.contextmanager
def work_in(dirname=None):'''Context manager version of os.chdir.

    When exited, returns to the working directory prior to entering.
    '''
    curdir = os.getcwd()
    try:
        if dirname is not None:
            os.chdir(dirname)
        yield
    finally:
        os.chdir(curdir)


def make_executable(script_path):
    '''Make `script_path` executable.

    :param script_path: The file to change
    '''
    status = os.stat(script_path)
    os.chmod(script_path, status.st_mode | stat.S_IEXEC)


def prompt_and_delete(path, no_input=False):
    """
    Ask user if it's okay to delete the previously-downloaded file/directory.

    If yes, delete it. If no, checks to see if the old version should be
    reused. If yes, it's reused; otherwise, Cookiecutter exits.

    :param path: Previously downloaded zipfile.
    :param no_input: Suppress prompt to delete repo and just delete it.
    :return: True if the content was deleted
    """
    
    if not no_input:
        ok_to_delete = True
    else:
        question = \
            "You've downloaded {} before. Is it okay to delete and re-download it?".format(
            path)
        
        ok_to_delete = read_user_yes_no(question, 'yes')
    
    if ok_to_delete:
        if os.path.isdir(path):
            rmtree(path)
        else:
            os.remove(path)
        return True
    else:
        ok_to_reuse = read_user_yes_no(
            'Do you want to re-use the existing version?', 'yes')
        
        
        if ok_to_reuse:
            return False
        
        sys.exit()</pre>

    </div>
</body>
</html>